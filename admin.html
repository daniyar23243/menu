<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Админ-панель</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 10px;
    }
    h1, h2 {
      text-align: center;
    }
    input, select, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background: #45a049;
    }
    .admin-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      background: #fff;
      border-radius: 8px;
      margin: 5px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .admin-item button {
      width: auto;
      background: #e63946;
    }
    .tglb{
      background: darkgray !important;
    }
    .tglb1{
      background: #4CAF50 !important;
    }
  </style>
</head>
<body>

<h1>Админ-панель</h1>

<!-- Добавить категорию -->
<h2>Добавить категорию</h2>
<input id="cat_ru" placeholder="Название категории (RU)">
<input id="cat_en" placeholder="Название категории (EN)">
<input id="cat_kg" placeholder="Название категории (KG)">
<input id="cat_img" placeholder="URL картинки">
<button onclick="addCategory()">Добавить категорию</button>

<div id="categoryList"></div>

<hr>

<!-- Добавить товар -->
<h2>Добавить товар</h2>
<select id="categorySelect"></select>
<input id="item_ru" placeholder="Название (RU)">
<input id="item_en" placeholder="Название (EN)">
<input id="item_kg" placeholder="Название (KG)">
<input id="item_price" placeholder="Цена">
<input id="item_img" placeholder="URL картинки">
<button onclick="addItem()">Добавить товар</button>

<div id="itemsList"></div>

<script>

// ===== ЗАГРУЗИТЬ СПИСОК КАТЕГОРИЙ =====
function loadCategories() {
  fetch("http://localhost:3000/admin/categories")
    .then(res => res.json())
    .then(data => {
      // Обновляем выпадающий список категорий
      const select = document.getElementById("categorySelect");
      select.innerHTML = "";
      data.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat.id;
        option.textContent = cat.name_ru;
        select.appendChild(option);
      });

      // Обновляем список категорий с кнопкой удалить
      const list = document.getElementById("categoryList");
      list.innerHTML = "<h2>Категории</h2>";

      data.forEach(cat => {
        const div = document.createElement("div");
        div.classList.add("admin-item");
        div.innerHTML = `
          <span>${cat.name_ru}</span>
          <button class = "${cat.is_hidden ? "tglb1" : "tglb"}" onclick="toggleCategory(${cat.id})">
            ${cat.is_hidden ? "Показать" : "Скрыть"}
          </button>
          <button onclick="deleteCategory(${cat.id})">Удалить</button>
        `;
        list.appendChild(div);
      });
    });
}

// ===== ДОБАВИТЬ КАТЕГОРИЮ =====
function addCategory() {
  const body = {
    name_ru: cat_ru.value,
    name_en: cat_en.value,
    name_kg: cat_kg.value,
    image_url: cat_img.value
  };

  fetch("http://localhost:3000/categories", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body)
  }).then(() => {
    alert("Категория добавлена!");
    loadCategories();
  });
}

// ===== УДАЛИТЬ КАТЕГОРИЮ =====
function deleteCategory(id) {
  if (!confirm("Удалить категорию?")) return;

  fetch(`http://localhost:3000/categories/${id}`, {
    method: "DELETE"
  }).then(() => {
    alert("Категория удалена");
    loadCategories();
    loadItems(); // обновить список товаров
  });
}

// ===== ЗАГРУЗИТЬ СПИСОК ТОВАРОВ =====
function loadItems() {
  fetch("http://localhost:3000/admin/categories")
    .then(res => res.json())
    .then(async categories => {
      const list = document.getElementById("itemsList");
      list.innerHTML = "<h2>Товары</h2>";

      for (const cat of categories) {
        const title = document.createElement("h3");
        title.textContent = cat.name_ru;
        list.appendChild(title);

        const items = await fetch(`http://localhost:3000/admin/categories/${cat.id}/items`)
          .then(r => r.json());

        items.forEach(item => {
          const div = document.createElement("div");
          div.classList.add("admin-item");
          div.innerHTML = `
            <span>${item.name_ru} — ${item.price} сом</span>
            <button class = "${item.is_hidden ? "tglb1" : "tglb"}" onclick="toggleItem(${item.id})">
              ${item.is_hidden ? "Показать" : "Скрыть"}
            </button>
            <button onclick="deleteItem(${item.id})">Удалить</button>
          `;
          list.appendChild(div);
        });
      }
    });
}

// ===== ДОБАВИТЬ ТОВАР =====
function addItem() {
  const body = {
    category_id: categorySelect.value,
    name_ru: item_ru.value,
    name_en: item_en.value,
    name_kg: item_kg.value,
    price: item_price.value,
    image_url: item_img.value
  };

  fetch("http://localhost:3000/items", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body)
  }).then(() => {
    alert("Товар добавлен!");
    loadItems();
  });
}

// ===== УДАЛИТЬ ТОВАР =====
function deleteItem(id) {
  if (!confirm("Удалить товар?")) return;

  fetch(`http://localhost:3000/items/${id}`, {
    method: "DELETE"
  }).then(() => {
    alert("Товар удалён");
    loadItems();
  });
}

// ===== ПЕРЕКЛЮЧИТЬ ВИДИМОСТЬ КАТЕГОРИИ =====
function toggleCategory(id) {
  fetch(`http://localhost:3000/categories/${id}/toggle`, {
    method: "PATCH"
  }).then(() => {
    loadCategories();
    loadItems();
  });
}
// ===== ПЕРЕКЛЮЧИТЬ ВИДИМОСТЬ ТОВАРА =====
function toggleItem(id) {
  fetch(`http://localhost:3000/items/${id}/toggle`, {
    method: "PATCH"
  }).then(() => {
    loadItems();
  });
}
// ========= ПЕРВАЯ ЗАГРУЗКА ==========
loadCategories();
loadItems();

</script>

</body>
</html>
